<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Class: MarketEngine</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Class: MarketEngine</h1>

    




<section>

<header>
    
        <h2><span class="attribs"><span class="type-signature"></span></span>MarketEngine<span class="signature">(options<span class="signature-attributes">opt</span>)</span><span class="type-signature"></span></h2>
        
            <div class="class-description">Market "Engine" providing some minimal housekeeping functions for a trading exchange, but no economic functions.</div>
        
    
</header>

<article>
    <div class="container-overview">
    
        

    
    <h2>Constructor</h2>
    

    
    <h4 class="name" id="MarketEngine"><span class="type-signature"></span>new MarketEngine<span class="signature">(options<span class="signature-attributes">opt</span>)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    create MarketEngine
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        
        <th>Default</th>
        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            
                <td class="default">
                
                    {pushArray:1}
                
                </td>
            

            <td class="description last">options copied to this.o
                <h6>Properties</h6>
                

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>goods</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last">sets name of goods to be traded in this market</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>money</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last">sets name of money used in this market</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>pushArray</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last">set to 1 if orders are numeric arrays, affects .push handling, accept/reject is in order[0] after prepending 2 elements</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>pushObject</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last">set to 1 if orders are objects, affects .push handling, accept/reject is in order.ok</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>idCol</code></td>
            

            <td class="type">
            
                
<span class="param-type">number</span>
|

<span class="param-type">string</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last">order column number or name for id number of agent submitting the order</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>cancelCol</code></td>
            

            <td class="type">
            
                
<span class="param-type">number</span>
|

<span class="param-type">string</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last">order column number or name for indicating cancellation (1) or no cancellation (0) of previous orders by this agent</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>tCol</code></td>
            

            <td class="type">
            
                
<span class="param-type">number</span>
|

<span class="param-type">string</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last">order column number or name for time of order</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>txCol</code></td>
            

            <td class="type">
            
                
<span class="param-type">number</span>
|

<span class="param-type">string</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last">order column number or name for expiration time of order</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>qCol</code></td>
            

            <td class="type">
            
                
<span class="param-type">number</span>
|

<span class="param-type">string</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last">order column number or name for quantity to buy or sell</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>noBump</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last">if truthy, no cancel/expire search of old orders is performed when pre-processing new orders</td>
        </tr>

    
    </tbody>
</table>

            </td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="index.mjs.html">index.mjs</a>, <a href="index.mjs.html#line26">line 26</a>
    </li></ul></dd>
    

    

    

    
</dl>







<h5>Listens to Events:</h5>
<ul>
    <li>event:{trade-cleanup(tradespec)} to reduce order quantity by quantity tradedo</li>
</ul>














    
    </div>

    

    

    
        <h3 class="subsection-title">Classes</h3>

        <dl>
            <dt><a href="MarketEngine.html">MarketEngine</a></dt>
            <dd></dd>
        </dl>
    

    

    

    

    
        <h3 class="subsection-title">Members</h3>

        
            
<h4 class="name" id="a"><span class="type-signature"></span>a<span class="type-signature"> :Array.&lt;(Object|Array.&lt;number>)></span></h4>




<div class="description">
    list of active orders
orders may be objects or arrays of fixed length
</div>



    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type">Array.&lt;(Object|Array.&lt;number>)></span>


        </li>
    </ul>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="index.mjs.html">index.mjs</a>, <a href="index.mjs.html#line70">line 70</a>
    </li></ul></dd>
    

    

    

    
</dl>






        
            
<h4 class="name" id="count"><span class="type-signature"></span>count<span class="type-signature"> :number</span></h4>




<div class="description">
    counter of order number stamp
</div>



    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type">number</span>


        </li>
    </ul>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="index.mjs.html">index.mjs</a>, <a href="index.mjs.html#line85">line 85</a>
    </li></ul></dd>
    

    

    

    
</dl>






        
            
<h4 class="name" id="o"><span class="type-signature"></span>o<span class="type-signature"> :Object</span></h4>




<div class="description">
    options passed to constructor
</div>



    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type">Object</span>


        </li>
    </ul>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="index.mjs.html">index.mjs</a>, <a href="index.mjs.html#line54">line 54</a>
    </li></ul></dd>
    

    

    

    
</dl>






        
            
<h4 class="name" id="trash"><span class="type-signature"></span>trash<span class="type-signature"> :Array.&lt;number></span></h4>




<div class="description">
    list of indexes into this.a[] of trashed orders to be removed
</div>



    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type">Array.&lt;number></span>


        </li>
    </ul>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="index.mjs.html">index.mjs</a>, <a href="index.mjs.html#line77">line 77</a>
    </li></ul></dd>
    

    

    

    
</dl>






        
    

    
        <h3 class="subsection-title">Methods</h3>

        
            

    

    
    <h4 class="name" id="bump"><span class="type-signature"></span>bump<span class="signature">(neworder)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    cancel or expire orders prior to processing new order.
new orders can be marked cancelReplace, necessitating a cancel search.
new orders also update simulation time, necessitating an expired order search.
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>neworder</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>
|

<span class="param-type">Array.&lt;number></span>


            
            </td>

            

            

            <td class="description last"></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="index.mjs.html">index.mjs</a>, <a href="index.mjs.html#line114">line 114</a>
    </li></ul></dd>
    

    

    

    
</dl>





<h5>Fires:</h5>
<ul>
    <li>event:{bump} after cancelling or expiring any old orders</li>
</ul>
















        
            

    

    
    <h4 class="name" id="cancel"><span class="type-signature"></span>cancel<span class="signature">(id)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    find and cancel previous orders by id.
Orders are cancelled by setting quantity to 0 and adding to trash list.
Optimistic searching is done: if an order is found which itself has a cancelCol set, the search is complete.
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>id</code></td>
            

            <td class="type">
            
                
<span class="param-type">number</span>


            
            </td>

            

            

            <td class="description last">The id number of an agent whose orders will be cancelled.</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="index.mjs.html">index.mjs</a>, <a href="index.mjs.html#line258">line 258</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="clear"><span class="type-signature"></span>clear<span class="signature">()</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    clear active and trash list, reset counter, and emit clear event
</div>













<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="index.mjs.html">index.mjs</a>, <a href="index.mjs.html#line99">line 99</a>
    </li></ul></dd>
    

    

    

    
</dl>





<h5>Fires:</h5>
<ul>
    <li>event:{clear} after clearing active and trash lists and resetting counter</li>
</ul>
















        
            

    

    
    <h4 class="name" id="emptyTrash"><span class="type-signature"></span>emptyTrash<span class="signature">()</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    delete the orders in the trash list from the active list.
Orders are deleted from the active list using Array.splice, so order indexes in this.a[] will also change.
</div>













<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="index.mjs.html">index.mjs</a>, <a href="index.mjs.html#line286">line 286</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="expire"><span class="type-signature"></span>expire<span class="signature">(ts)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    find and expire orders.
Orders are expired if supplied time ts is greater than order txCol.
Orders are expired by setting quantity to 0 and adding to trash list
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>ts</code></td>
            

            <td class="type">
            
                
<span class="param-type">number</span>


            
            </td>

            

            

            <td class="description last">The current effective market time</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="index.mjs.html">index.mjs</a>, <a href="index.mjs.html#line233">line 233</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="push"><span class="type-signature"></span>push<span class="signature">(order)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    "push" a new order to the market
performs housekeeping:
1. pre-adding fields such as processing timestamp and order number
1. emitting before-order(myorder,function reject()) to allow customized order acceptance/rejection rules
1. if rejected, emitting reject(myorder) to allow additional processing or logging of rejected orders, after setting a rejection flag (which can still be unset)
1. assigning the order number in myorder[0]
1. emitting preorder(myorder) for logging or additional processing before order affects books, other orders, or trades
1. procesing any cancellation or expiration triggered in pre-processing of the order with this.bump(myorder)
1. If the this.a active list exists, add the new order to the active list
1. emit order(myorder) to allow for additional customized processing (such as identifying trades or enforcing other rules)
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>order</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>
|

<span class="param-type">Array.&lt;number></span>


            
            </td>

            

            

            <td class="description last">A new order to the market for processing</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="index.mjs.html">index.mjs</a>, <a href="index.mjs.html#line144">line 144</a>
    </li></ul></dd>
    

    

    

    
</dl>





<h5>Fires:</h5>
<ul>
    <li>{before-order(myorder,event: reject())} to allow customized rejection rules for orders</li>

    <li>event:{reject(myorder)} to allow for logging or other processing of rejected orders</li>

    <li>event:{preorder(myorder)} to allow for logging or other processing of acceptable orders</li>

    <li>event:{order(myorder)} to allow customized rules and trading procedures</li>
</ul>
















        
            

    

    
    <h4 class="name" id="reduceQ"><span class="type-signature"></span>reduceQ<span class="signature">(ais, qs)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    reduce the amounts of orders at active array indexes ais by amounts qs.
Calls trash.push(ais[i]), pushing indexes to trash list, for affected orders reduced to zero quantity.
Reducing an order to a negative quantity throws Error.
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>ais</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;number></span>


            
            </td>

            

            

            <td class="description last">Indexes in the active array this.a[] of the orders to be affected.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>qs</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;number></span>


            
            </td>

            

            

            <td class="description last">Amounts for reduction in the quantity of the affected orders.</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="index.mjs.html">index.mjs</a>, <a href="index.mjs.html#line189">line 189</a>
    </li></ul></dd>
    

    

    

    
</dl>













<h5>Throws:</h5>

        

<dl>
    <dt>
        <div class="param-desc">
        if order is reduced to a negative quantity
        </div>
    </dt>
    <dd></dd>
    <dt>
        <dl>
            <dt>
                Type
            </dt>
            <dd>
                
<span class="param-type">Error</span>


            </dd>
        </dl>
    </dt>
    <dd></dd>
</dl>


    







        
            

    

    
    <h4 class="name" id="trade"><span class="type-signature"></span>trade<span class="signature">(tradeSpec)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    Register a trade in this market.
Sets tradespec.goods and tradespec.money to market goods and money, if any.
Then emits trade(tradeSpec), trade-cleanup(tradeSpec), and after-trade(tradeSpec) for further processing.
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>tradeSpec</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            

            

            <td class="description last"></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="index.mjs.html">index.mjs</a>, <a href="index.mjs.html#line216">line 216</a>
    </li></ul></dd>
    

    

    

    
</dl>





<h5>Fires:</h5>
<ul>
    <li>event:{trade(tradeSpec)} to allow custom processing of trade</li>

    <li>event:{trade-cleanup(tradeSpec)} to allow custom cleanup of market structures after processing trade</li>

    <li>event:{after-trade(tradeSpec)} to allow custom post-processing after trade</li>
</ul>
















        
    

    

    
</article>

</section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="MarketEngine.html">MarketEngine</a></li></ul><h3>Global</h3><ul><li><a href="global.html#reject">reject</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.10</a> on Sun Feb 13 2022 03:33:52 GMT-0500 (Eastern Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>